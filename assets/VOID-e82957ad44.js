function throttle(o,n,a){var r,i=new Date;return function(){var e=arguments,t=new Date;clearTimeout(r),a<=t-i?(o.apply(this,e),i=t):r=setTimeout(o,n)}}function checkGoTop(){$(document).scrollTop()>window.innerHeight?$("#back-top").fadeIn(300):$("#back-top").fadeOut(200)}console.log(" %c Theme VOID %c https://blog.imalan.cn/archives/247/ ","color: #fadfa3; background: #23b7e5; padding:5px;","background: #1c2b36; padding:5px;");var getDeviceState=function(e){var t;return window.getComputedStyle?t=window.getComputedStyle(e).getPropertyValue("z-index"):e.currentStyle&&(t=e.currentStyle["z-index"]),parseInt(t,10)},getPrefersDarkModeState=function(){var e=document.createElement("div");return e.className="dark-mode-state-indicator",document.body.appendChild(e),11===getDeviceState(e)};function setCookie(e,t,o){document.cookie=e+"="+escape(t)+";max-age="+String(o)+";path=/"}function getCookie(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),o=document.cookie.match(t);return o?unescape(o[2]):null}var VOID={init:function(){if(VOID.countWords(),VOID.parseTOC(),VOID.parsePhotos(),VOID.parseUrl(),VOID.initCopyLink(),VOID.hitokoto(),VOID.handleLike(),pangu.spacingElementByTagName("p"),VOID.highlight(),$.bigfoot({actionOriginalFN:"ignore"}),$(".board-item").on("touchstart",function(){$(this).addClass("hover")}),$(".board-item").on("touchend",function(){$(this).removeClass("hover")}),checkGoTop(),VOIDConfig.lazyload&&window.addEventListener("scroll",throttle(VOID.lazyLoad,100,1e3)),0==VOIDConfig.headerMode){var e=document.querySelector("body>header");new Headroom(e,{offset:60}).init()}AjaxComment.init()},parsePhotos:function(){$.each($(".photos"),function(e,t){$.each($(t).children(),function(e,o){var n=new Image;n.src=$(o).find("img").attr("data-src"),n.onload=function(){var e=parseFloat(n.width),t=parseFloat(n.height);$(o).css("width",50*e/t+"px"),$(o).css("flex-grow",50*e/t),$(o).find("a").css("padding-top",t/e*100+"%")}})})},parseUrl:function(){var o=document.domain;$('a:not(a[href^="#"]):not(".post-like")').each(function(e,t){(!$(t).attr("target")||""==!$(t).attr("target")&&"_self"==!$(t).attr("target"))&&t.host!=o&&$(t).attr("target","_blank")}),VOIDConfig.PJAX&&($.each($('a:not(a[target="_blank"], a[no-pjax])'),function(e,t){t.host==o&&$(t).addClass("pjax")}),$(document).pjax("a.pjax",{container:"#pjax-container",fragment:"#pjax-container",timeout:8e3,scrollTo:!1}))},hitokoto:function(){$.ajax({url:"https://v1.hitokoto.cn/?c=a&encode=json",async:!0,success:function(e){$("#hitokoto").html(e.hitokoto+" - 「"+e.from+"」")}})},beforePjax:function(){NProgress.start(),$(".toggle").removeClass("pushed"),$(".mobile-search").removeClass("opened"),$("header").removeClass("opened"),$("body").hasClass("modal-open")&&VOID.closeModal(),$("#nav-mobile").fadeOut(200),0<$(".TOC").length&&tocbot.destroy()},alert:function(e,t){var o=(new Date).getTime();$("body").prepend('<div class="msg" id="msg{id}">{Text}</div>'.replace("{Text}",e).replace("{id}",o)),$.each($(".msg"),function(e,t){$(t).attr("id")!="msg"+o&&$(t).css("top",$(t).offset().top-$(document).scrollTop()+$(".msg#msg"+o).outerHeight()+20+"px")}),$(".msg#msg"+o).addClass("show");var n=t;"number"!=typeof n&&(n=2500),setTimeout(function(){$(".msg#msg"+o).addClass("hide"),setTimeout(function(){$(".msg#msg"+o).remove()},1e3)},n)},handleLike:function(){var n=getCookie("void_likes");null!=n&&$.each($(".post-like"),function(e,t){var o=String($(t).attr("data-cid"));-1!=n.indexOf(","+String(o)+",")&&$(t).addClass("done")})},afterPjax:function(){$("#banner").length?$("body>header").removeClass("no-banner"):$("body>header").addClass("no-banner"),VOID.countWords(),VOID.parseTOC(),VOID.parsePhotos(),VOID.parseUrl(),VOID.initCopyLink(),VOID.reload(),VOID.handleLike(),AjaxComment.init(),checkGoTop()},reload:function(){VOID.highlight(),"undefined"!=typeof MathJax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub]),"undefined"!=typeof _hmt&&_hmt.push(["_trackPageview",location.pathname+location.search]),pangu.spacingElementByTagName("p"),getSocial(),$(".board-item").on("touchstart",function(){$(this).addClass("hover")}),$(".board-item").on("touchend",function(){$(this).removeClass("hover")}),$.bigfoot({actionOriginalFN:"ignore"}),0<$(".OwO").length&&new OwO({logo:"OωO",container:document.getElementsByClassName("OwO")[0],target:document.getElementsByClassName("input-area")[0],api:"/usr/themes/VOID/assets/libs/owo/OwO_01.json",position:"down",width:"400px",maxHeight:"250px"})},scrollTop:0,openModal:function(){VOID.scrollTop=document.scrollingElement.scrollTop,document.body.classList.add("modal-open"),document.body.style.top=-VOID.scrollTop+"px"},closeModal:function(){document.body.classList.remove("modal-open"),document.scrollingElement.scrollTop=VOID.scrollTop},toggleArchive:function(e){$(e).parent().hasClass("shrink")?($(e).html("-"),$(e).parent().removeClass("shrink")):($(e).html("+"),$(e).parent().addClass("shrink"))},parseTOC:function(){if(0<$(".TOC").length){tocbot.init({tocSelector:".TOC",contentSelector:"div[itemprop=articleBody]",headingSelector:"h2, h3, h4, h5",collapseDepth:6}),$.each($(".toc-link"),function(e,t){var o=$(document.getElementById($(t).attr("href").replace("#",""))).offset().top;$(t).click(function(){return $.scrollTo(o,300),!1})})}},highlight:function(){$.each($('pre code:not([class*="language-"])'),function(e,t){var o=$(t).attr("class");o=void 0!==o?"language-"+o.replace("lang-",""):"language-",$(t).addClass(o)}),Prism.highlightAll()},lazyLoad:function(){var n=document.documentElement.clientHeight,a=document.documentElement.scrollTop||document.body.scrollTop;$.each($("img.lazyload"),function(e,t){if($(t).offset().top<n+a&&$(t).offset().top+$(t).height()>a&&!$(t).hasClass("loaded")&&!$(t).hasClass("error")){var o=new Image;o.src=$(t).attr("data-src"),o.onload=function(){$(t).animate({opacity:0},150),setTimeout(function(){$(t).attr("src",$(t).attr("data-src")),$(t).addClass("loaded"),$(t).animate({opacity:1},180)},180)},o.onerror=function(){$(t).addClass("error")}}})},countWords:function(){if($("#totalWordCount").length){var o=0;$.each($("a.archive-title"),function(e,t){o+=parseInt($(t).attr("data-words"))}),$("#totalWordCount").html(o)}},goTop:function(){var e=document.documentElement.scrollTop||document.body.scrollTop;0<e?(requestAnimationFrame(VOID.goTop),window.scrollTo(0,e-e/5)):cancelAnimationFrame(VOID.goTop)},like:function(o){var n=parseInt($(o).attr("data-cid")),a=getCookie("void_likes");null==a&&(a=","),-1!=a.indexOf(","+String(n)+",")?VOID.alert("您已经点过赞了~"):$.post(VOIDConfig.likePath,{cid:n},function(e){$(o).addClass("done");var t=$(o).find(".like-num").text();$(o).find(".like-num").text(parseInt(t)+1),setCookie("void_likes",a=a+String(n)+",",604800)},"json")},clipboards:[],initCopyLink:function(){for(i=0;i<VOID.clipboards.length;i++)VOID.clipboards.pop().destroy();if($.each($("h2 .copy-link, h3 .copy-link, h4 .copy-link"),function(e,t){loc=encodeURI(window.location.origin+window.location.pathname+"#"+$(t).parent().attr("id")),$(t).attr("data-clipboard-text",loc),$(t).addClass("loaded").html("¶")}),$(".copy-link").length){var e=new ClipboardJS(".copy-link");e.on("success",function(e){VOID.alert("章节链接已复制")}),e.on("error",function(e){VOID.alert("抱歉，无法复制章节链接。请联系站长。")}),VOID.clipboards.push(e)}}},DarkModeSwitcher={mapTzGeo:{"America/Denver":[39.7645187,-104.9951977],"Europe/London":[51.5287352,-.3817843],"America/Chicago":[41.8339042,-88.0121562],"America/Asuncion":[-25.2966809,-57.6681298],"America/Montevideo":[-34.8207362,-56.3765247],"Asia/Beirut":[33.8892846,35.4692627],"Pacific/Auckland":[-36.8621448,174.5852782],"America/Los_Angeles":[34.0207305,-118.6919292],"America/New_York":[40.6976701,-74.2598739],"America/Halifax":[43.7085882,-63.475903],"America/Godthab":[64.1791647,-51.7768494],"Asia/Dubai":[25.0757073,54.9475461],"Asia/Jakarta":[-6.2293867,106.6894293],"Asia/Shanghai":[31.2243084,120.9162622],"Australia/Sydney":[-33.8473567,150.6517817],"Asia/Tokyo":[35.5062896,138.6484937],"Asia/Dhaka":[23.7808875,90.2792377],"Asia/Baku":[40.3947695,49.7148734],"Australia/Brisbane":[-27.3798035,152.4327106],"Pacific/Noumea":[-22.2642742,166.4098471],"Pacific/Majuro":[7.1045756,171.3526867],"Pacific/Tongatapu":[-21.1695566,-175.3350296],"Asia/Baghdad":[33.3118944,44.2158179],"Asia/Karachi":[25.1933895,66.5949598],"Africa/Johannesburg":[-26.1713505,27.9699839],default:[39.9390731,116.1172655]},switchColorScheme:function(e,t){var o=new Date,n=e.getHours()+e.getMinutes()/60,a=t.getHours()+t.getMinutes()/60,r=o.getHours()+o.getMinutes()/60;if(null==getCookie("theme_dark"))if(n<r||r<a){document.body.classList.add("theme-dark"),n<r&&(t=new Date(t.getTime()+864e5));var i=(t.getTime()-o.getTime())/1e3;setCookie("theme_dark","1",parseInt(i)),VOID.alert("日落了，夜间模式已开启。")}else document.body.classList.remove("theme-dark");else{var s=getCookie("theme_dark");"0"==s?document.body.classList.remove("theme-dark"):"1"==s&&document.body.classList.add("theme-dark")}},checkColorSchemeFallback:function(){var e=jstz.determine();e=e.name(),e=DarkModeSwitcher.mapTzGeo.hasOwnProperty(e)?DarkModeSwitcher.mapTzGeo[e]:DarkModeSwitcher.mapTzGeo.default,sunset=(new Date).sunset(e[0],e[1]),sunrise=(new Date).sunrise(e[0],e[1]),sunset=new Date((new Date).setHours(sunset.getHours(),sunset.getMinutes(),0)),sunrise=new Date((new Date).setHours(sunrise.getHours(),sunrise.getMinutes(),0)),DarkModeSwitcher.switchColorScheme(sunset,sunrise)},checkColorScheme:function(){0==VOIDConfig.colorScheme&&(getPrefersDarkModeState()&&VOIDConfig.followSystemColorScheme?(document.body.classList.add("theme-dark"),"1"!=getCookie("theme_dark")&&VOID.alert("已为您开启深色模式。"),setCookie("theme_dark","1",7200)):VOIDConfig.accurateDarkMode&&"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){sunset=(new Date).sunset(e.coords.latitude,e.coords.longitude),sunrise=(new Date).sunrise(e.coords.latitude,e.coords.longitude),sunset=new Date((new Date).setHours(sunset.getHours(),sunset.getMinutes(),0)),sunrise=new Date((new Date).setHours(sunrise.getHours(),sunrise.getMinutes(),0)),DarkModeSwitcher.checkColorScheme(sunset,sunrise)},function(){DarkModeSwitcher.checkColorSchemeFallback()}):DarkModeSwitcher.checkColorSchemeFallback())}};DarkModeSwitcher.checkColorScheme();var AjaxComment={noName:"必须填写用户名",noMail:"必须填写电子邮箱地址",noContent:"必须填写评论内容",invalidMail:"邮箱地址不合法",commentsOrder:"DESC",commentList:".comment-list",comments:"#comments .comments-title",commentReply:".comment-reply",commentForm:"#comment-form",respond:".respond",textarea:"#textarea",submitBtn:"#comment-submit-button",newID:"",parentID:"",bindClick:function(){$(AjaxComment.commentReply+" a, #cancel-comment-reply-link").unbind("click"),$(AjaxComment.commentReply+" a").click(function(){AjaxComment.parentID=$(this).parent().parent().parent().attr("id"),$(AjaxComment.textarea).focus()}),$("#cancel-comment-reply-link").click(function(){AjaxComment.parentID=""})},err:function(){$(AjaxComment.submitBtn).attr("disabled",!1),AjaxComment.newID=""},finish:function(){TypechoComment.cancelReply(),$(AjaxComment.submitBtn).html("提交评论"),$(AjaxComment.textarea).val(""),$(AjaxComment.submitBtn).attr("disabled",!1),0<$("#comment-"+AjaxComment.newID).length&&($.scrollTo($("#comment-"+AjaxComment.newID).offset().top-50,500),$("#comment-"+AjaxComment.newID).fadeTo(500,1)),$(".comment-num .num").html(parseInt($(".comment-num .num").html())+1),AjaxComment.bindClick(),VOID.highlight()},init:function(){AjaxComment.bindClick(),$(AjaxComment.commentForm).submit(function(){if($(AjaxComment.submitBtn).attr("disabled",!0),$(AjaxComment.commentForm).find("#author")[0]){if(""==$(AjaxComment.commentForm).find("#author").val())return VOID.alert(AjaxComment.noName),AjaxComment.err(),!1;if(""==$(AjaxComment.commentForm).find("#mail").val())return VOID.alert(AjaxComment.noMail),AjaxComment.err(),!1;if(!/^[^@\s<&>]+@([a-z0-9]+\.)+[a-z]{2,4}$/i.test($(AjaxComment.commentForm).find("#mail").val()))return VOID.alert(AjaxComment.invalidMail),AjaxComment.err(),!1}var e=$(AjaxComment.commentForm).find(AjaxComment.textarea).val().replace(/(^\s*)|(\s*$)/g,"");return null==e||""==e?(VOID.alert(AjaxComment.noContent),AjaxComment.err()):($(AjaxComment.submitBtn).html("提交中"),$.ajax({url:$(AjaxComment.commentForm).attr("action"),type:$(AjaxComment.commentForm).attr("method"),data:$(AjaxComment.commentForm).serializeArray(),error:function(){return VOID.alert("提交失败！请重试。"),$(AjaxComment.submitBtn).html("提交评论"),AjaxComment.err(),!1},success:function(e){try{if($(AjaxComment.commentList,e).length){if(AjaxComment.newID=$(AjaxComment.commentList,e).html().match(/id="?comment-\d+/g).join().match(/\d+/g).sort(function(e,t){return e-t}).pop(),$(".pager .prev").length&&""==AjaxComment.parentID)return VOID.alert("评论成功！请回到评论第一页查看。"),AjaxComment.newID="",AjaxComment.parentID="",AjaxComment.finish(),!1;var t=""==AjaxComment.parentID?"comment-parent":"comment-child",o='<div itemscope itemtype="http://schema.org/UserComments" id="comment-'+AjaxComment.newID+'" style="opacity:0" class="comment-body '+t+'">'+$(e).find("#comment-"+AjaxComment.newID).html()+"</div>";return $(AjaxComment.commentList).length<=0&&$("#comments").append('<h3 class="comment-separator"><div class="comment-tab-current"><span class="comment-num">已有 <span class="num">0</span> 条评论</span></div></h3>').append('<div class="comment-list"></div>'),""==AjaxComment.parentID?($("#comments>.comment-list").prepend(o),VOID.alert("评论成功！"),AjaxComment.finish()):($("#"+AjaxComment.parentID).hasClass("comment-parent")?0<$("#"+AjaxComment.parentID+" > .comment-children").length?$("#"+AjaxComment.parentID+" > .comment-children > .comment-list").prepend(o):(o='<div class="comment-children"><div class="comment-list">'+o+"</div></div>",$("#"+AjaxComment.parentID).append(o)):$("#"+AjaxComment.parentID).after(o),VOID.alert("评论成功！"),AjaxComment.finish(),AjaxComment.parentID=""),AjaxComment.newID="",!1}var n="提交失败！请重试。"+$($(e)[7]).text();return VOID.alert(n),$(AjaxComment.submitBtn).html("提交评论"),AjaxComment.err(),!1}catch(e){window.location.reload()}}})),!1})}};function startSearch(e){var t=$(e).val();if($(e).val(""),$(e).blur(),t&&""!=t){var o=VOIDConfig.searchBase+t;VOIDConfig.PJAX?$.pjax({url:o,container:"#pjax-container",fragment:"#pjax-container",timeout:8e3}):window.open(o,"_self")}else $(e).attr("placeholder","你还没有输入任何信息")}function enterSearch(e){13==(window.event||arguments.callee.caller.arguments[0]).keyCode&&startSearch(e)}function toggleSearch(){$(".mobile-search").toggleClass("opened"),setTimeout(function(){$(".mobile-search").hasClass("opened")?$(".mobile-search input").focus():$(".mobile-search input").blur()},400)}function toggleNav(e){$(e).toggleClass("pushed"),$("header").toggleClass("opened"),$(e).hasClass("pushed")?($("#nav-mobile").fadeIn(200),VOID.openModal()):(VOID.closeModal(),$("#nav-mobile").fadeOut(200))}function toggleToc(e){$(".TOC").toggleClass("show"),$(".toggle-toc").toggleClass("pushed"),$(e).toggleClass("pushed")}$(document).ready(function(){VOID.init()}),VOIDConfig.PJAX&&($(document).on("pjax:send",function(){VOID.beforePjax()}),$(document).on("pjax:complete",function(){VOID.afterPjax()}),$(document).on("pjax:end",function(){NProgress.done(),setTimeout(function(){var e=new URL(window.location.href).hash;""!=e?$.scrollTo($(e).offset().top-80,500):VOID.goTop()},50)})),setInterval(function(){var e=(new Date).getTime()-Date.parse(VOIDConfig.buildTime);e=Math.floor(e/1e3);var t=Math.floor(e/86400);e%=86400;var o=Math.floor(e/3600);e%=3600;var n=Math.floor(e/60);e%=60;var a=Math.floor(e/1);$("#uptime").html(t+" 天 "+o+" 小时 "+n+" 分 "+a+" 秒 ")},1e3),window.addEventListener("scroll",function(){if(checkGoTop(),VOIDConfig.headerColorScheme&&!$("body>header").hasClass("no-banner")&&2!=VOIDConfig.headerMode){var e=767<$(window).width()?150:80;$(document).scrollTop()>e?$("body>header").addClass("dark"):$("body>header").removeClass("dark")}});